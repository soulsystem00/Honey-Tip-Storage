# 다운캐스팅과 업캐스팅

다운캐스팅과 업캐스팅은 상속을 사용하면 많이 사용하게 되는 것 같음  
일단 2개의 차이는 순서의 차이로 보면 될 것 같음  
근데 찾아보니깐 내가 알고 있는 순서랑 달라서 당황했음  
근데 순서의 차이일 뿐이지 개념만 알고 있으면 되서  
사용하는데 딱히 상관은 없었음  
</br>
일단 부모 - 자식 간의 캐스팅을 할 때 사용되는 말임  
대충 아래와 같은 코드로 보면  

```
public class Parent
{
    public int p;
}

public class Child : Parent
{
    public int c;
}

static void Main()
{
    Parent p = new Parent();
    Child c = new Child();
}
```

보통 클래스를 인스턴스화 시킬 때  
원래 클래스 이름으로 인스턴스화를 시키는게 보통임  
Parent 클래스는 Parent로 인스턴스화 시키고  
Child 클래스는 Child로 인스턴스화를 시켰음  
</br>
근데 상속관계에선 특이하게 인스턴스화 시킬 수가 있는데  

```
Parent p = new Child();
```

요런 식으로 선언은 Parent로 해놓고  
인스턴스화는 Child로 하는 게 가능함  
이게 업 캐스팅이라고 함  
</br>
자식 객체를 부모 객체로 형 변환을 해준 것임  
형 변환이기 때문에 일반적인 형 변환처럼도 사용이 가능함  

```
Child c = new Child();
Parent p = (Parent)c;
```

요딴 식으로 캐스팅 해주면 됨  
근데 이 캐스팅을 생략해도 알아서 잘 들어가는 것 같음  
아무튼 자식객체를 부모객체로 캐스팅은 얼마든지 가능하다는 것임  
</br>
그런데 이런식으로 했을 때 단점이라면  
p 객체는 Parent 클래스이기 때문에  
Parent 클래스에 선언되어있는 변수나 함수에만 접근이 가능하다는 것임  
</br>
그런데 Child로 인스턴스화 시켰기 때문에  
메모리에는 Child의 크기만큼 할당이 되었을 것임  
이 말인 즉슨, Child의 변수, 함수가 메모리에는 살아있으니깐  
얼마든지 접근이 가능하다는 이야기인데  
그걸 하기 위해선 아래와 같은 방법을 사용하면 됨  

```
Parent p = new Child();
((Child)p).c = 0;
```
이게 다운 캐스팅임   
그러니깐 p 객체를 Child 클래스로 확장시켜서  
Child 클래스에 있는 변수, 함수에 접근을 하겠다는 소리임  
</br>
</br>
이렇게 양 쪽으로 캐스팅이 되면 코드를 짤 때 굉장히 편리해지는데  
클래스와 상속을 배울 때 Person 클래스가 있고, Student가 있고 Teacher가 있고  
부모 클래스는 공통된 속성으로 묶고  
파생 클래스는 각 클래스가 가지고 있는 고유의 속성을 가지고  
뭐 이런 것들을 배웠는데  
</br>
왜 이따구로 복잡하게 코드를 짜는거지 라고 생각을 했었는데  
다운/업 캐스팅을 알게되니깐 그 이유를 조금이나마 이해를 할 수 있었음  
</br>
이를테면 PersonManager가 있고 부모 자식간 캐스팅이 안된다면  
Student에 대한 배열, Teacher에 대한 배열 뭐 이따구로 만들어서  
각자 따로 관리를 해줘야하거나 하는데  
</br>
업/다운 캐스팅을 사용하면 그냥 Person에 대한 배열 하나만 만들고  
거기다가 Student던 Teacher던 싹다 집어넣을 수 있으니깐  
굉장히 편리한 관리가 됨  
</br>
근데 여기서 궁금증이 하나 생기는데  
위와 같은 구조를 코드로 짜면 아래와 같이 될 텐데

```
public class Person
{

}

public class Teacher : Person
{

}

public class Student : Person
{

}

```


그러니깐 `Person p = new Teacher()` 뭐 요딴식으로 선언을 하면  
p 객체는 그냥 `Person` 객체일 뿐이고  
컴파일러에선 p 객체가 원래 어떤 클래스였는지를 모른다는 점이 있음  
</br>
p를 Teacher 클래스로의 캐스팅은 당연히 가능하겠지만  
p를 Student 클래스로의 캐스팅은 당연히 불가능 함  
그런데 컴파일러에선 p 객체는 그냥 Person 클래스일 뿐이기 때문에  
Student로 변형을 시키는 것에 대해 딱히 오류를 내뱉지 않음  
</br>
그래서 만약에 배열같은데에 싹다 넣어놓은 뒤에  
원소 하나를 빼와서 캐스팅을 하면서 사용을 하려면  
일단 컴파일러에선 오류를 내뱉지 않기 때문에  
굉장히 유의하면서 코드를 짜야할 것 같음  
아님 아예 다른 방법을 사용하던가  
</br>
GetType()을 사용하면 원래 클래스를 알 수 있는 듯 하다.  
</br>
</br>
그리고 아예 반대의 케이스는 어떻게 될 지도 궁금했는데
```
Teacher t = new Person();
```

어쩌면 당연한 결과일 수 있지만 위와 같은 코드는 오류가 남   
부모클래스로 자식 객체를 인스턴스화 시키는 건 안됨  
</br>
</br>
</br>
</br>
</br>
### 잡담   

```
약간 사족이긴 한데  
글의 서두에 업캐스팅 다운 캐스팅 순서에 대해 이야기를 했는데 
이게 무슨 소리냐면 

처음에는 업 캐스팅이 다운 캐스팅인 줄 알았고 
다운 캐스팅이 업 캐스팅인 줄 알았음  
그러다가 이 글을 작성하면서 찾아보니 용어가 반대라는 걸 알게 되었음 

그런데 처음에 왜 그렇게 생각을 했냐면
업그레이드 / 다운그레이드의 개념으로 생각을 했기 때문에 그랬음
부모 클래스의 기능은 보통 기초적인 기능밖에 없고
자식 클래스는 부모 클래스의 기능을 이어 받아 더 많이 구현을 했기 때문에 

부모 -> 자식 으로의 캐스팅은 업그레이드가 되는거니깐 업 캐스팅
자식 -> 부모 로의 캐스팅은 기능이 제한되는  
즉, 다운그레이드가 되니깐 다운 캐스팅
이렇게 생각을 했었음  

근데 이걸 찾아보니깐
업/다운이 업그레이드/다운그레이드 에서 오는 것이 아니라
트리 구조에서 오는 것이었음 

부모 - 자식 구조는 
    부모            가 위에 있고
자식 자식 자식      이 아래에 있으니깐 

부모 -> 자식으로의 캐스팅은 위에서 아래로 가는 다운 캐스팅이 되는 거고
자식 -> 부모로의 캐스팅은 아래에서 위로 가는 거니깐 업 캐스팅이 되는 것이었음  

그래서 순서라고 이야기를 한거임  
아무튼 용어를 바꿔서 생각을 했었다는 거임  
```