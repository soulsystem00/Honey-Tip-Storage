# 윈폼 크로스쓰레드

어떻게 보면 Timer를 알아보면서 확실해진건데</br>
윈폼에선 UI 쓰레드라는게 존재한다.</br>
그리고 해당 쓰레드에서 UI의 갱신하는 등의 행동을 한다.</br>
만약에 UI 쓰레드가 아닌 다른 쓰레드에서 UI 요소들에 접근하면 오류가 발생한다.</br>
</br>
UI 쓰레드의 존재는 몰랐지만 이런 것이 있을 것이다라는 건 어렴풋이 느낌이 왔었다.</br>
왜냐하면 내가 독립적인 쓰레드를 만들고</br>
 해당 쓰레드에서 `label.text` 같은 것들을 수정하려고 하면</br>
종종 크로스 쓰레드 어쩌구 하면서 오류가 발생했기 때문이다.</br>
</br>
처음에는 왜 안되지? 하는 생각뿐이었지만</br>
점점 윈폼과 쓰레드에 대해 알아가면서</br>
뭔가 UI는 다른 쓰레드에서 동작을 하는 것 같다는 느낌을 받았고</br>
이런 점 때문에 관련 오류가 발생하는 것 같다는 느낌을 받았다.</br>
</br>
그러다가 Timer를 찾아보면서 UI 쓰레드의 존재에 대해 알게 되었고</br>
확실해진 것이다.</br>
</br>
</br>
이것에 대한 해결방법은 간단하다.</br>
대충 다른 쓰레드에서 UI 요소를 컨트롤 하고 싶으면</br>
아래와 같은 코드를 사용하며 된다.

```
if(label.InvokeRequired)
{
    label.Invoke(new MethodInvoker(delegate()
    {
        label.Text = "Hello World";
    }));
}
else
{
    label.Text = "Hello World";
}
```
대충 InvokeRequired는 Invoke가 필요한 상태인지 체크하는 함수이다.</br>
만약에 UI 쓰레드가 아닌 곳에서 label을 호출하려고 하면 true가 될 것이고</br>
아니라면 false가 될 것이다.</br>
</br>
그렇게 해서 UI 쓰레드가 아닌 곳에서 UI를 호출을 했다 라고한다면</br>
Invoke에 대리자를 등록시키고</br>
UI가 UI 쓰레드에서 호출이 될 때 대리자를 호출해 줌으로써</br>
UI 쓰레드에서 컨트롤이 되도록 만들어 주는 것이다.</br>
</br>
</br>
그리고 해당 예제와 비슷하지만</br>
매개변수를 던져줄 수 있는 방법도 있었다.</br>

```
delegate void ParamDelegate(string text);

if(label.InvokeRequired)
{
    label.Invoke(new ParamDelegate((_) => 
    {
        label.Text = _;
    }), new object[] {"Hello World"});
}
else
{
    label1.Text = "Hello World";
}
```

델리게이트 선언해서 해당 델리게이트를 Invoke에 등록해주면 된다.</br>
람다를 사용해서 좀 복잡해 보일 수도 있는데</br>
뭐 대충 요런식으로 사용한다.</br>
</br>
</br>
아무튼 이러한 특징이 윈폼에서만 나타나는 줄 알았는데</br>
굉장히 다양한 곳에서 UI는 UI쓰레드에서만 접근이 가능하도록 만들어놓았다고 한다.</br>
어쩌면 당연한 이야기인데 막 드러나질 않다보니</br>
잊어먹기 쉬운 특징인 것 같다.</br>
</br>
</br>
</br>
</br>
</br>
### 잡담

```
원래는 이걸 작성하려던게 아니고
작성하고 싶었던게 있었는데
도저히 생각이 나질 않았다.

그래서 결국 생각이 나면 일단 메모를 해놓기로 결정을 했다.
그렇게 결정을 하자마자 2개의 주제가 적혀졌다.
물론 이전에 적고싶던 내용은 아직까지 생각이 안난다.

아무튼 그렇다.

그리고 뭔가 계속 쓰레드 관련된 이야기만 적는 것 같은 느낌적인 느낌이 들고 있다.
```